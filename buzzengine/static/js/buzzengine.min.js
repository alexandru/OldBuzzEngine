(function(){var c={};function d(){var y=document.getElementById("comments");return y.getAttribute("data-domain")}function j(){return navigator.userAgent.indexOf("MSIE")!=-1}function o(y){return(y.constructor!=String?y:document.getElementById(y))}function s(y){o(y).style.display="block"}function i(y){o(y).style.display="none"}function l(z){z=o(z);if(z==document){return true}if(!z){return false}if(!z.parentNode){return false}if(z.style){if(z.style.display=="none"){return false}if(z.style.visibility=="hidden"){return false}}if(window.getComputedStyle){var y=window.getComputedStyle(z,"");if(y.display=="none"){return false}if(y.visibility=="hidden"){return false}}var y=z.currentStyle;if(y){if(y.display=="none"){return false}if(y.visibility=="hidden"){return false}}return isVisible(z.parentNode)}function x(A,y,z){if(!j()){o(A).addEventListener(y,z,false)}else{o(A).addEventListener(y,z)}}function v(z,y){o(z).setAttribute("class",y)}function t(I){var B=I.name;var H=I.type;var y=I.tag;var F=o("comments");var z=y?[y]:["input","textarea","button"];for(var D=0;D<z.length;D++){tag_name=z[D];var E=F.getElementsByTagName(tag_name);if(!E){continue}for(var C=0;C<E.length;C++){var A=E[C];var G=1;if(B&&A.getAttribute("name")!=B){G=0}if(H&&A.getAttribute("type")!=H){G=0}if(G){return A}}}}function r(z){var F=window.location+"";var y=F.match(/^[^?]+[?](.+)$/);if(y&&y.length>1){var D=y[1];var E=D.split(/[&]/);for(var C=0;C<E.length;C++){var B=E[C].split(/[=]/);var A=decodeURI(B[0]);if(A==z){return B.length>1?decodeURI(B[1]):""}}}return""}function p(D,y){var B=o(D);var z=B.getElementsByTagName("*");for(var A=0;A<z.length;A++){var C=z[A];var E=C.getAttribute("class");if(E&&(E==y||E.match(/cls/))){return C}}}function f(){return BUZZENGINE_PARAMS.article_url||(window.location+"")}function g(){var y=document.getElementsByTagName("title").length?document.getElementsByTagName("title")[0].innerHTML:null;return BUZZENGINE_PARAMS.article_title||y}function e(){var A=o("comments");var z=p(A,"data");var y=p(z,"current_author");return y.innerHTML}function b(){var E=o("comments");var B=E.getElementsByTagName("form")[0];var D=new Array();var y=B.getElementsByTagName("input");for(var A=0;A<y.length;A++){var z=y[A].getAttribute("name");if(!z){continue}var C=y[A].value||"";D.push(encodeURI(z)+"="+encodeURI(C))}return D.join("&")}function m(A,B,C){if(C){var z=new Date();z.setTime(z.getTime()+(C*24*60*60*1000));var y="; expires="+z.toGMTString()}else{var y=""}document.cookie=A+"="+B+y+"; path=/"}function a(z){var B=z+"=";var y=document.cookie.split(";");for(var A=0;A<y.length;A++){var C=y[A];while(C.charAt(0)==" "){C=C.substring(1,C.length)}if(C.indexOf(B)==0){return C.substring(B.length,C.length)}}return null}function w(y){m(y,"",-1)}function n(z,A){if(c[z]){return A()}var y=document.getElementsByTagName("head")[0];js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src",z);y.appendChild(js);js.onreadystatechange=function(){if(js.readyState=="complete"||js.readyState=="loaded"){if(!c[z]){c[z]=true;A()}}};js.onload=function(){if(!c[z]){c[z]=true;A()}};return false}function h(A){var z=A.url;var B=A.type||"GET";var E=A.success;var y=A.error;var D=A.data;function C(G){if(G.readyState==4){if(G.status==200&&E){E(G.responseText,G)}else{y(G)}}}var F=new flensed.flXHR({autoUpdatePlayer:false,instanceId:"myproxy1",xmlResponseText:false,onreadystatechange:C,loadPolicyURL:"http://"+d()+"/static/load-policy.xml"});F.open(B,z);F.send(D)}function k(G){var y=G.url;var C=G.type||"GET";var E=G.success;var D=G.error;var A=G.data;try{var F=new XMLHttpRequest()}catch(B){}if(F&&"withCredentials" in F){}else{if(typeof XDomainRequest!="undefined"){F=new XDomainRequest()}else{F=null}}if(!F){if(typeof flensed=="undefined"){n("http://"+d()+"/static/js/flXHR/flXHR.js",function(){h(G)})}else{h(G)}}else{var z=function(H){if(H.readyState==4){if(H.status==200&&E){E(H.responseText,H)}else{if(D){D(H)}}}};F.open(C,y,true);try{F.withCredentials=true}catch(B){}F.onload=function(H){z(H.target)};F.onerror=function(H){z(H.target)};F.send(A)}}function u(y){if(y){document.getElementById("comments").innerHTML=y}setTimeout(function(){t({name:"article_url"}).setAttribute("value",f());t({name:"article_title"}).setAttribute("value",g());var z=e();if(z){m("author",z,365)}x(o("comments").getElementsByTagName("form")[0],"submit",function(A){A.preventDefault();s(p("comments","loader"));i(p("comments","button"));k({url:this.getAttribute("action"),type:"POST",data:b(),success:function(B){u(B)},error:function(C){p("comments","errornote").remove();var B=o("comments").getElementsByTagName("form")[0];B.innerHTML="<div class='errornote'>Something wrong happened, please try again later!</div>"+B.innerHTML}});return false})},0)}function q(){var z=a("author");z=z?encodeURI(z):null;var y="http://"+d()+"/api/comments/";y+="?article_url="+encodeURI(window.location+"");if(z){y+="&author="+encodeURI(z)}k({url:y,type:"GET",success:function(A){u(A)}})}q()})();