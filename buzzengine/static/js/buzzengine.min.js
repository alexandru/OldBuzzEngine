(function(){var d={};function e(){var z=document.getElementById("comments");return z.getAttribute("data-domain")}function c(z){return Object.prototype.toString.call(z).match(/^\[object (.*)\]$/)[1]}function k(){return navigator.userAgent.indexOf("MSIE")!=-1}function p(z){return(c(z)!="String"?z:document.getElementById(z))}function t(z){p(z).style.display="block"}function j(z){p(z).style.display="none"}function n(A){A=p(A);if(A==document){return true}if(!A){return false}if(!A.parentNode){return false}if(A.style){if(A.style.display=="none"){return false}if(A.style.visibility=="hidden"){return false}}if(window.getComputedStyle){var z=window.getComputedStyle(A,"");if(z.display=="none"){return false}if(z.visibility=="hidden"){return false}}var z=A.currentStyle;if(z){if(z.display=="none"){return false}if(z.visibility=="hidden"){return false}}return isVisible(A.parentNode)}function y(B,z,A){if(!k()){p(B).addEventListener(z,A,false)}else{p(B).addEventListener(z,A)}}function w(A,z){p(A).setAttribute("class",z)}function u(J){var C=J.name;var I=J.type;var z=J.tag;var G=p("comments");var A=z?[z]:["input","textarea","button"];for(var E=0;E<A.length;E++){tag_name=A[E];var F=G.getElementsByTagName(tag_name);if(!F){continue}for(var D=0;D<F.length;D++){var B=F[D];var H=1;if(C&&B.getAttribute("name")!=C){H=0}if(I&&B.getAttribute("type")!=I){H=0}if(H){return B}}}}function s(A){var G=window.location+"";var z=G.match(/^[^?]+[?](.+)$/);if(z&&z.length>1){var E=z[1];var F=E.split(/[&]/);for(var D=0;D<F.length;D++){var C=F[D].split(/[=]/);var B=decodeURI(C[0]);if(B==A){return C.length>1?decodeURI(C[1]):""}}}return""}function q(E,z){var C=p(E);var A=C.getElementsByTagName("*");for(var B=0;B<A.length;B++){var D=A[B];var F=D.getAttribute("class");if(F&&(F==z||F.match(/cls/))){return D}}}function g(){return BUZZENGINE_PARAMS.article_url||(window.location+"")}function h(){var z=document.getElementsByTagName("title").length?document.getElementsByTagName("title")[0].innerHTML:null;return BUZZENGINE_PARAMS.article_title||z}function f(){var B=p("comments");var A=q(B,"data");var z=q(A,"current_author");return z.innerHTML}function b(){var E=p("comments");var A=E.getElementsByTagName("form")[0];var B=new Array();var F=new Array();var D=A.getElementsByTagName("input");var G=A.getElementsByTagName("textarea");for(var C=0;C<D.length;C++){F.push(D[C])}for(var C=0;C<G.length;C++){F.push(G[C])}for(var C=0;C<F.length;C++){var z=F[C].getAttribute("name");if(!z){continue}var H=F[C].value||"";B.push(encodeURI(z)+"="+encodeURI(H))}return B.join("&")}function m(B,C,D){if(D){var A=new Date();A.setTime(A.getTime()+(D*24*60*60*1000));var z="; expires="+A.toGMTString()}else{var z=""}document.cookie=B+"="+C+z+"; path=/"}function a(A){var C=A+"=";var z=document.cookie.split(";");for(var B=0;B<z.length;B++){var D=z[B];while(D.charAt(0)==" "){D=D.substring(1,D.length)}if(D.indexOf(C)==0){return D.substring(C.length,D.length)}}return null}function x(z){m(z,"",-1)}function o(A,B){if(d[A]){return B()}var z=document.getElementsByTagName("head")[0];js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src",A);z.appendChild(js);js.onreadystatechange=function(){if(js.readyState=="complete"||js.readyState=="loaded"){if(!d[A]){d[A]=true;B()}}};js.onload=function(){if(!d[A]){d[A]=true;B()}};return false}function i(B){var A=B.url;var C=B.type||"GET";var F=B.success;var z=B.error;var E=B.data;function D(H){if(H.readyState==4){if(H.status==200&&F){F(H.responseText,H)}else{z(H)}}}var G=new flensed.flXHR({autoUpdatePlayer:false,instanceId:"myproxy1",xmlResponseText:false,onreadystatechange:D,loadPolicyURL:"http://"+e()+"/static/load-policy.xml"});G.open(C,A);G.send(E)}function l(H){var z=H.url;var D=H.type||"GET";var F=H.success;var E=H.error;var B=H.data;try{var G=new XMLHttpRequest()}catch(C){}if(G&&"withCredentials" in G){}else{if(typeof XDomainRequest!="undefined"){G=new XDomainRequest()}else{G=null}}if(!G){if(typeof flensed=="undefined"){o("http://"+e()+"/static/js/flXHR/flXHR.js",function(){i(H)})}else{i(H)}}else{var A=function(I){if(I.readyState==4){if(I.status==200&&F){F(I.responseText,I)}else{if(E){E(I)}}}};G.open(D,z,true);try{G.withCredentials=true}catch(C){}G.onload=function(I){A(I.target)};G.onerror=function(I){A(I.target)};G.send(B)}}function v(z){if(z){document.getElementById("comments").innerHTML=z}setTimeout(function(){u({name:"article_url"}).setAttribute("value",g());u({name:"article_title"}).setAttribute("value",h());var A=f();if(A){m("author",A,365)}y(p("comments").getElementsByTagName("form")[0],"submit",function(B){B.preventDefault();t(q("comments","loader"));j(q("comments","button"));l({url:this.getAttribute("action"),type:"POST",data:b(),success:function(C){v(C)},error:function(D){q("comments","errornote").remove();var C=p("comments").getElementsByTagName("form")[0];C.innerHTML="<div class='errornote'>Something wrong happened, please try again later!</div>"+C.innerHTML}});return false})},0)}function r(){var A=a("author");A=A?encodeURI(A):null;var z="http://"+e()+"/api/comments/";z+="?article_url="+encodeURI(window.location+"");if(A){z+="&author="+encodeURI(A)}l({url:z,type:"GET",success:function(B){v(B)}})}r()})();

