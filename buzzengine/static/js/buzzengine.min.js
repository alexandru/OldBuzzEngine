(function(){var e={};function f(){var z=document.getElementById("comments");return z.getAttribute("data-domain")}function d(z){return Object.prototype.toString.call(z).match(/^\[object (.*)\]$/)[1]}function l(){return navigator.userAgent.indexOf("MSIE")!=-1}function b(){var B=-1;if(navigator.appName=="Microsoft Internet Explorer"){var z=navigator.userAgent;var A=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(A.exec(z)!=null){B=parseFloat(RegExp.$1)}}return B}function q(z){return(d(z)!="String"?z:document.getElementById(z))}function t(z){q(z).style.display="block"}function k(z){q(z).style.display="none"}function o(A){A=q(A);if(A==document){return true}if(!A){return false}if(!A.parentNode){return false}if(A.style){if(A.style.display=="none"){return false}if(A.style.visibility=="hidden"){return false}}if(window.getComputedStyle){var z=window.getComputedStyle(A,"");if(z.display=="none"){return false}if(z.visibility=="hidden"){return false}}var z=A.currentStyle;if(z){if(z.display=="none"){return false}if(z.visibility=="hidden"){return false}}return isVisible(A.parentNode)}function y(C,z,A){var B=q(C);if(B.addEventListener&&!l()){B.addEventListener(z,A,false)}else{if(B.addEventListener){B.addEventListener(z,A)}else{if(B.attachEvent){B.attachEvent("on"+z,A)}}}}function w(A,z){q(A).setAttribute("class",z)}function u(J){var C=J.name;var I=J.type;var z=J.tag;var G=q("comments");var A=z?[z]:["input","textarea","button"];for(var E=0;E<A.length;E++){tag_name=A[E];var F=G.getElementsByTagName(tag_name);if(!F){continue}for(var D=0;D<F.length;D++){var B=F[D];var H=1;if(C&&B.getAttribute("name")!=C){H=0}if(I&&B.getAttribute("type")!=I){H=0}if(H){return B}}}}function r(E,z){var C=q(E);var A=C.getElementsByTagName("*");for(var B=0;B<A.length;B++){var D=A[B];var F=D.getAttribute("class");if(F&&(F==z||F.match(/cls/))){return D}}}function h(){return BUZZENGINE_PARAMS.article_url||(window.location+"")}function i(){var z=document.getElementsByTagName("title").length?document.getElementsByTagName("title")[0].innerHTML:null;return BUZZENGINE_PARAMS.article_title||z}function g(){var B=q("comments");var A=r(B,"data");var z=r(A,"current_author");return z.innerHTML}function c(){var E=q("comments");var A=E.getElementsByTagName("form")[0];var B=new Array();var F=new Array();var D=A.getElementsByTagName("input");var G=A.getElementsByTagName("textarea");for(var C=0;C<D.length;C++){F.push(D[C])}for(var C=0;C<G.length;C++){F.push(G[C])}for(var C=0;C<F.length;C++){var z=F[C].getAttribute("name");if(!z){continue}var H=F[C].value||"";B.push(encodeURI(z)+"="+encodeURI(H))}return B.join("&")}function n(B,C,D){if(D){var A=new Date();A.setTime(A.getTime()+(D*24*60*60*1000));var z="; expires="+A.toGMTString()}else{var z=""}document.cookie=B+"="+C+z+"; path=/"}function a(A){var C=A+"=";var z=document.cookie.split(";");for(var B=0;B<z.length;B++){var D=z[B];while(D.charAt(0)==" "){D=D.substring(1,D.length)}if(D.indexOf(C)==0){return D.substring(C.length,D.length)}}return null}function x(z){n(z,"",-1)}function p(A,B){if(e[A]){return B()}var z=document.getElementsByTagName("head")[0];js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src",A);z.appendChild(js);js.onreadystatechange=function(){if(js.readyState=="complete"||js.readyState=="loaded"){if(!e[A]){e[A]=true;B()}}};js.onload=function(){if(!e[A]){e[A]=true;B()}};return false}function j(B){var A=B.url;var C=B.type||"GET";var F=B.success;var z=B.error;var E=B.data;function D(H){if(H.readyState==4){if(H.status==200&&F){F(H.responseText,H)}else{z(H)}}}var G=new flensed.flXHR({autoUpdatePlayer:false,instanceId:"myproxy1",xmlResponseText:false,onreadystatechange:D,loadPolicyURL:"http://"+f()+"/static/load-policy.xml"});G.open(C,A);G.send(E)}function m(I){var z=I.url;var E=I.type||"GET";var G=I.success;var F=I.error;var C=I.data;try{var H=new XMLHttpRequest()}catch(D){}var A=false;if(H&&"withCredentials" in H){H.open(E,z,true)}else{if(typeof XDomainRequest!="undefined"){H=new XDomainRequest();H.open(E,z)}else{H=null}}if(!H){if(typeof flensed=="undefined"){p("http://"+f()+"/static/js/flXHR/flXHR.js",function(){j(I)})}else{j(I)}}else{var B=function(J){return function(K){var K=l()?H:K;if(J=="load"&&(l()||K.readyState==4)&&G){G(K.responseText,K)}else{if(F){F(K)}}}};try{H.withCredentials=true}catch(D){}H.onload=function(J){B("load")(l()?J:J.target)};H.onerror=function(J){B("error")(l()?J:J.target)};H.send(C)}}function v(z){if(z){document.getElementById("comments").innerHTML=z}if(l()&&b()<8){k(document.getElementById("comments").getElementsByTagName("form")[0]);return}setTimeout(function(){u({name:"article_url"}).setAttribute("value",h());u({name:"article_title"}).setAttribute("value",i());var A=g();if(A){n("author",A,365)}var B=q("comments").getElementsByTagName("form")[0];y(B,"submit",function(C){if(l()){C.returnValue=false}else{if(C.preventDefault){C.preventDefault()}}t(r("comments","loader"));k(r("comments","button"));m({url:B.getAttribute("action"),type:"POST",data:c(),success:function(D){v(D)},error:function(D){r("comments","errornote").remove();B.innerHTML="<div class='errornote'>Something wrong happened, please try again later!</div>"+B.innerHTML}});return false})},0)}function s(){var A=a("author");A=A?encodeURI(A):null;var z="http://"+f()+"/api/comments/";z+="?article_url="+encodeURI(window.location+"");if(A){z+="&author="+encodeURI(A)}m({url:z,type:"GET",success:function(B){v(B)}})}s()})();

